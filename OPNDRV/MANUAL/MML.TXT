MMLファイル文法

1.注釈

　ファイル中「;」で始まる行は、行末まで無視されます。

2.コマンド

　コマンドは、「\コマンド名[引数]...{コマンド列}」という書式を持ちます。

■分解能設定コマンド

●\division[分解能]

  4分音符の分解能を決めます。以降出て来るチャネル定義コマンドにおいて有効です。
  分解能を高くすればするほど、細かい音符の表現が誤差なくできますが、その分OPNDRVの割り込み回数が増して全体のテンポが乱れることもあります。
　デフォルトは48です。このコマンドは、必ずチャネル定義コマンドよりも先に書いてください。

■チャネル定義コマンド

●\fm[チャネル番号]{MMLデータ列}
　
　FM音源データを定義します。チャネル番号は、1から6までの6チャネル分あります。同一チャネルを何度定義しても構いません。複数定義した場合には、順に繋がれて解釈されます。FM音源チップがYM2203の場合には、チャネル4～チャネル6は演奏されません。

●\psg[チャネル番号]{MMLデータ列}

  PSG音源データを定義します。チャネル番号は、1から3までの3チャンネルです。同一チャネルを何度定義しても構いません。複数定義した場合には、順に繋がれて解釈されます。

●\rth[チャネル番号]{MMLデータ列}

  リズム音源データを定義します。チャネル番号は、1から6までの6チャネル分で、
  
  チャネル1-バスドラム、
  チャネル2-スネアドラム
  チャネル3-シンバル
  チャネル4-ハイハット
  チャネル5-タム
  チャネル6-リムショット
  
  に対応しています。同一チャネルを何度定義しても構いません。複数定義した場合には、順に繋がれて解釈されます。FM音源チップがYM2203の場合には、リズム部は演奏されません。

●\se[チャネル数][割り込み優先度]{MMLデータ列}

  効果音データを定義します。チャネル数は、1でPSGのチャネル2を、2でPSGのチャネル3を、3でPSGのチャネル2とチャネル3の同時指定を意味します。
  割り込み優先度は、1～63までの整数で、大きいほど優先順位が高くなります。優先順位とは、効果音発声コマンド送出時にすでに効果音が鳴っていた場合、どちらを優先するかを決めるものです。
  SEコマンド内でのMMLデータ列には、PSGチャネルと同じものが使用できます。なお、同一チャネルを複数回定義することは許されません。再生する時に使用するSE番号は、定義された順番に0、1、…と割り当てられます。
　このコマンドは、上の\fm、\psg、\rthとは、排他的な関係になければなりません。つまり、上の\fm、\psg、\rthコマンドがある場合には、\seコマンドは使用できません。MMLファイル内に\seコマンドがある場合には、MML2OPN.EXEで、SEファイルが作成され、\seコマンドがない場合には、OPNファイルが作成されます。
　SEのMML内で、PCM音源関連コマンドを使用することにより、PCMによる効果音の発声も可能です。

■音色定義コマンド

●\soundfm[音色番号]{音色データ}

  FM音源の音色定義をします。音色番号は、0～127までの整数で、MMLコマンド*sstおよび@で参照されます。音色番号は、コマンド\soundpsgと共通です。音色データは、次のような順序でならべます。音色の二重定義はできません。

{音色データ}=
{(Operator1)AttackRate, DecayRate, SustainRate, ReleaseRate, SustainLevel, TotalLevel, KeyScale, Multiple, Detune,
 (Operator2)同上,
 (Operator3)同上,
 (Operator4)同上,
FeedBack/Algorithm
}
※AttackRate, DecayRate, SustainRate, ReleaseRate, DecayLevel, TotalLevelに関しては、N88-BASICとは大小関係が逆ですので注意してください。
 
●\soundpsg[音色番号]{音色データ}

  PSG音源の音色を設定します。音色番号は、0～127までの整数で、MMLコマンド*sstで参照されます。音色番号は、コマンド\soundfmと共通です。音色の二重定義はできません。
　音色といっても、単なるボリューム列です。音色データには、ボリュームを0から15の範囲で設定します。キーオン時より、そのボリュームデータ通りにボリュームが動きます。

●\pcm[PCM番号]{PCMファイル名}

  指定した番号にPCMファイルを割り当てます。後述するMMLコマンド*pcmでこの番号を指定することにより、割り当てたPCMファイルの演奏が可能となります。音色番号は、0～99までです。

3.MMLコマンド

■音程関係コマンド

●音程設定　C,D,E,F,G,A,B

  発音音程を設定します。各文字はドレミファソラシに対応します。文字の後ろに「+」をつけると半音上がり、「-」をつけると半音下がります。ただし、複数個付けて、ダブルフラット、ダブルシャープといった表現はできません。
　文字の後ろに数字をつけることで、音長の設定ができます。設定しない場合には、後述するLコマンドの設定値となります。
　文字の後ろに、「.」をつけて、音長を1.5倍にすることができます。ただし、複数個「.」をつけることはできません。
　音長は、通常のMMLの音長の他、絶対音長というものが扱えます。普通、C4とあらわした場合には、4分音符のドの音を指しますが、C*4としてアスタリスクをつけると、タイマカウント4つ分の音長を指します。タイマカウントは、コマンド\divisionで指定します。divisionの定義から、1絶対音長は、4分音符の1/division倍の長さです。
　絶対音長は、「L」コマンドでは使用できないので注意してください。

●休符　R

  休符を表現します。音程設定文字と同様に、後ろに数値を付けて音長の設定をしたり、「.」で音長を1.5倍にすることが可能です。絶対音長表現も可能です。

●オクターブ設定 O

  後ろに1～8までの数字をつけることで、オクターブの設定をします。

●オクターブ相対指定 >, <

  「>」でオクターブを1つ上げます、「<」でオクターブを1つ下げます。

※リズム音源の場合

　リズム音源の場合には、音程という要素がないので、オクターブ指定および音程指定は無視されます。その代わりに以下のMMLが使用できます。

●ボリュームつきリズムON A～H

  ドラムを叩きます。文字で叩く強さを決めます。A(強い)～H(弱い)です。

●リズムON X

  ドラムを叩きます。叩く強さは、Vコマンドなどで指定したボリュームとなります。

●ウェイト P

  指定時間ウェイトします。Rコマンドと同じですが、キーオフしません。

■音長設定/テンポコマンド

●音長設定 L

  後ろに数値nを付けて、以降のデフォルトの音長の指定します。指定後の音長は、n分音符となります。

●テンポ設定 T

  テンポの設定をします。1分間での四分音符の数を指定します。デフォルトのテンポは存在しないので、MMLのどこかで必ずテンポ設定をしてください。

■ボリューム設定コマンド

●ボリューム設定 V

  ボリュームの設定をします。設定値は、0(最小)～15(最大)です。PSG音源で、ボリューム設定コマンドを指定すると、設定されていた音色設定コマンド(@)は無効となります。

●FM音源/リズム音源ボリューム設定 @V

  FM音源の細かいボリューム設定をします。FM音源およびリズム音源のみ有効です。FM音源の場合には、0(最小)～127(最大)、リズム音源の場合には0(最小)～31(最大)となります。

■音色設定

●音色設定　@音色番号

　音色を設定します。音色番号は、\soundfmや\soundpsgで設定したものを指定します。たとえば、@12とすると、音色番号12にセットされます。FM音源部で、PSGの音色を設定したり、その逆は絶対に行なわないでください。
　音色設定を行なうと、設定されていたボリュームは、無効となります。

■ステレオ制御(YM2608チップのみ有効)

●@M

  左、右両方から音が出るようにします。

●@R

  右のみから音が出るようにします。

●@L

  左のみから音が出るようにします。

■繰り返し制御

●繰り返し |:n / :|

  「|:」と「:|」で囲まれた部分をn回演奏します。nは省略可能で、省略時はn=2です。また、繰り返し記号中「/」が見つかると、最終ループ時にその場所でループから抜けます。|: A B /C :|Dならば、ABCABDと演奏されます。

■コマンド

●ラベル

　後述するジャンプコマンドの飛び先を示すラベルです。文字「@@」のあとに、「a」～「z」までの文字列のいずれかを1つつけます。すなわち、26個までのラベルをつけることが可能です。ラベルは、チャネルごとに独立したものとなっており、他のチャネルにジャンプしたりすることはできません。

●内部変数

　OPNDRV内には0から99までの番号のついた100個の変数があります。コマンドの*if1、*if2などと組み合わせてループさせるなど、曲データ制御に使うことができます。
  MMLでは、@@0～@@99という名称で示します。この変数は、すべてのチャネルで共通のものとなっていますので注意してください。
  変数は1バイトで表現されているので、扱える範囲は0～255です。

●特殊コマンド

　特殊コマンドは、「*」のあとに3文字の文字列が続きます。「*」は絶対音長の設定にも使うので、例えば、「C*ton」としてしまうと、「*」が絶対音長の「*」かコマンド開始の「*」かがわからなくなりますので、コマンドの前には必ず空白を入れて、「C *ton」のようにしてください。

■コマンドリファレンス

●ton

[書式]
  *ton
[音源]
  FM、PSG、RTH
[用途]
　タイを開きます。以降*tofコマンドでタイが閉じられるまで、キーオフしません。

●tof

[書式]
  *tof
[音源]
  FM、PSG、RTH
[用途]
　*tonコマンドで開かれたタイを閉じます。

●sml

[書式]
  *sml[モジュレータレベル]
[音源]
  FM
[用途]
　モジュレータのレベルを指定します。0～127の範囲で指定し、小さい方が変調がきつくなります。

●sol

[書式]
  *sol[オペレータ番号],[アウトプットレベル]
[音源]
  FM、PSG、RTH
[用途]
　指定したオペレータのアウトプットレベル(=トータルレベル)を指定値に変更します。オペレータ番号は1から4、レベルは、0(最大)～127(最小)の間で指定してください。

●ssp

[書式]
  *ssp[速度値]
[音源]
  PSG
[用途]
　ボリューム変化速度を指定します。PSGの音色は、ボリューム列によって指定しますが、その読み取り速度を設定します。通常は、1になっていて、1つづつボリュームデータを読んでいきますが、たとえば、2に設定すると、1つおきにボリュームデータを読むことになります。

●kon

[書式]
  *kon[キーオン時間]
[音源]
  FM
[用途]
　キーオン時間を設定します。設定値をnとすると、キーオン時間は、音長の2^(-n)倍となります。

●sst

[書式]
  *sst[音色番号]
[音源]
  FM、PSG
[用途]
  音色を設定します。MMLコマンドの@と同じです。音色番号は、0～127です。

●sns

[書式]
  *sns[ノイズ周波数]
[音源]
  PSG
[用途]
　ノイズ周波数を設定します。0～31の範囲で指定してください。

●spo

[書式]
  *spo[ポルタメント幅]
[音源]
  FM、PSG
[用途]
　ポルタメント幅を指定します。-127～+127の範囲で指定してください。

●sdt

[書式]
  *sdt[ディチューン]
[音源]
  FM、PSG
[用途]
　ディチューン(=周波数の微妙なずれ)を指定します。-127～+127の範囲で指定してください。

●sfs

[書式]
  *sfs[フェードアウトスピード]
[音源]
  FM、PSG、RTH
[用途]
　フェードアウトします。小さいほど速くフェードアウトします。0～255の範囲で設定してください。

●msl

[書式]
  *msl[モード値]
[音源]
  PSG
[用途]
　PSGの発声モードを決めます。以下のいずれかの値を設定してください。
　
  62=トーンモード、55=ノイズモード、54=トーンノイズモード
  
  それ以外の数値を指定した場合の動作は保証しません。

●tmp

[書式]
  *tmp[タイマーBの値]
[音源]
  FM、PSG、RTH
[用途]
　テンポをタイマーBの値で直接指定します。テンポのタイマーBの値との関係は、
　
  タイマーB設定値=256 - 208200/(division×テンポ)
  
  です。通常使用において、このコマンドを使用することはまずないでしょう。

●ot1

[書式]
  *ot1[レジスタ],[データ]
[音源]
  FM、PSG、RTH
[用途]
　OPNのレジスタに直接データを送出します。データ送信後は、データポインタは進みません。

●ot2

[書式]
  *ot2[レジスタ],[データ]
[音源]
  FM、PSG、RTH
[用途]
　コマンド*ot1と同じです。ただし、データポインタは進みます。

●ict

[書式]
  *ict[割り込みスピード]
[音源]
  PSG
[用途]
　割り込み演奏のスピードを指定します。単位は、1/600秒です。初期値は4です。

●sta

[書式]
  *sta[タイマーA設定値]
[音源]
  PSG
[用途]
　割り込み演奏のスピードをタイマーAの値を直接指示することにより、細かく指定します。タイマーA設定値をTaとすると、
　
  12×(1024-Ta)/(3993.6/6)[ms]
  
  ごとに、割り込み演奏がなされます。

●ses

[書式]
  *ses[エンベロープスピード]
[音源]
  PSG
[用途]
　ハードウェアエンベロープのスピードを指定します。0～65535の範囲で指定してください。

●est

[書式]
  *est[波形番号]
[音源]
  PSG
[用途]
　ハードウェアエンベロープの形状を指定します。番号と波形の対応は、以下の通りです。

+-----------+------------------------------+
|番号       |波形                          |
+-----------+------------------------------+
|0,1,2,3,9  |｜＼＿＿＿＿＿＿＿＿＿＿＿＿＿|
+-----------+------------------------------+
|4,5,6,7,15 |／｜＿＿＿＿＿＿＿＿＿＿＿＿＿|
+-----------+------------------------------+
|8          |｜＼｜＼｜＼｜＼｜＼｜＼｜＼｜|
+-----------+------------------------------+
|10         |｜＼／＼／＼／＼／＼／＼／＼／|
+-----------+------------------------------+
|11         |｜＼｜￣￣￣￣￣￣￣￣￣￣￣￣|
+-----------+------------------------------+
|12         |／｜／｜／｜／｜／｜／｜／｜／|
+-----------+------------------------------+
|13         |／￣￣￣￣￣￣￣￣￣￣￣￣￣￣|
+-----------+------------------------------+
|14         |／＼／＼／＼／＼／＼／＼／＼／|
+-----------+------------------------------+

●jmp

[書式]
  *jmp[ラベル]
[音源]
  FM、PSG、RTH
[用途]
　指定されたラベルにデータポインタを移します。ラベルは、@@A～@@Zのいずれかです。
●let

[書式]
  *let[内部変数番号],[データ]
[音源]
  FM、PSG、RTH
[用途]
　指定された内部変数に、データを代入します。データは、0～255までの整数です。内部変数は、@@0～@@99のいずれかです。なお、内部変数は、全チャネルで共通したものとなっているので注意してください。

●inc

[書式]
  *inc[内部変数番号]
[音源]
  FM、PSG、RTH
[用途]
　指定された内部変数の内容を1増やします。内部変数は1バイトですので、内容が255の時に、incすると0に戻ります。

●dec

[書式]
  *dec[内部変数番号]
[音源]
  FM、PSG、RTH
[用途]
　指定された内部変数の内容を1減らします。内部変数は1バイトですので、内容が0の時に、decすると255になります。

●if1

[書式]
  *if1[内部変数番号],[ラベル]
[音源]
  FM、PSG、RTH
[用途]
　もし、内部変数内容が0ならば、指定されたラベルにデータポインタを移します。

●if2

[書式]
  *if2[内部変数番号],[ラベル]
[音源]
  FM、PSG、RTH
[用途]
　もし、内部変数内容が0でなければ1を引き、指定されたラベルにデータポインタを移します。

●ife

[書式]
  *ife[ラベル]
[音源]
  FM、PSG、RTH
[用途]
　もし、YM2608拡張機能が有効ならば、指定されたラベルにデータポインタを移します。
●ifp

[書式]
  *ifp[ラベル]
[音源]
  FM、PSG、RTH
[用途]
　もし、PCM機能が有効ならば、指定されたラベルにデータポインタを移します。

●svb

[書式]
  *svb[ディレイタイム],[スピード],[ステップ],[デプス]
[音源]
  FM、PSG
[用途]
　ビブラートの設定をします。各パラメータは、下の図の通りです。0～255までの整数で指定してください。

                ｮｲ                            ｮｲ---------------------
   ｽﾋﾟｰﾄﾞ-----ｮｺｶｲ                        ｮｺｶｲ      ↑              
   ---------ｮｺ    ｶｲ                    ｮｺ    ｶｲ     デプス          
          ｮｺ        ｶｲ                ｮｺ        ｶｲ  ↓            ｮｺ
｢｢｢｢｢ｺ            ｶｲ            ｮｺ            ｶｲ----------- ｮｺ
|←ﾃﾞｨﾚｲ  |             | ｶｲ        ｮｺ                ｶｲ        ｮｺ
|   ﾀｲﾑ →|             | | ｶｲ    ｮｺ                    ｶｲ    ｮｺ
                        | |   ｶｲｮｺ                        ｶｲｮｺ
                       ｽﾃｯﾌﾟ    ｶｺ                            ｶｺ

※横軸は時間、縦軸は周波数

●str

[書式]
  *str[ディレイタイム],[スピード],[ステップ],[デプス],[オペレータマスク]
[音源]
  FM
[用途]
　トレモロの設定をします。各パラメータは、下の図の通りです。0～255までの整数で指定してください。なお、オペレータマスクは、4ビット(=0～15)で指定し、下位ビットから、1ビットづつ、オペレータ1～オペレータ4と割り振られています。ビットを立てると、そのオペレータに対してのトレモロが有効となり、ビットが下がっていると、そのオペレータに対しては、なんの処理も行ないません。


                ｮｲ                            ｮｲ---------------------
   ｽﾋﾟｰﾄﾞ-----ｮｺｶｲ                        ｮｺｶｲ      ↑              
   ---------ｮｺ    ｶｲ                    ｮｺ    ｶｲ     デプス          
          ｮｺ        ｶｲ                ｮｺ        ｶｲ  ↓            ｮｺ
｢｢｢｢｢ｺ            ｶｲ            ｮｺ            ｶｲ----------- ｮｺ
|←ﾃﾞｨﾚｲ  |             | ｶｲ        ｮｺ                ｶｲ        ｮｺ
|   ﾀｲﾑ →|             | | ｶｲ    ｮｺ                    ｶｲ    ｮｺ
                        | |   ｶｲｮｺ                        ｶｲｮｺ
                       ｽﾃｯﾌﾟ    ｶｺ                            ｶｺ

※横軸は時間、縦軸はアウトプットレベル

●lon

[書式]
  *lon[LFO周波数]
[音源]
  FM(YM2608 only)
[用途]
　ハードウェアLFOを有効にします。音源チップがYM2608の時のみ有効です。周波数は、以下のいずれかを指定します。

  0=3.98Hz,1=5.56Hz,2=6.02Hz,3=6.37Hz,4=6.88Hz,5=9.63Hz,6=48.1Hz,7=72.2Hz

●lof

[書式]
  *lof
[音源]
  FM(YM2608 only)
[用途]
　ハードウェアLFOを無効にします。音源チップがYM2608の時のみ有効です。

●sap

[書式]
  *sap[AMS],[PMS],[AMON]
[音源]
  FM(YM2608 only)
[用途]
　振幅変調度(AMS)、位相変調度(PMS)、有効オペレータ選択(AMON)を指定します。音源チップがYM2608の時のみ有効です。値は、以下のようになります。

  AMS: 0=0db, 1=1.4db, 2=5.9db, 3=11.8db
  PMS: 0=±0cent,1=±3.4cent,2=±6.7cent,3=±10cent,
       4=±14cent,5=±20cent,6=±40cent,7=±80cent
       ※1オクターブ=1200cent
  AMON:オペレータマスクで、4ビットの値で指定します。下位ビットからオペレータ1～オペレータ4と1ビットずつ割り振られており、1でそのオペレータに対しての変調が有効になります。

●pcm

[書式]
  *pcm[PCM番号]
[音源]
  FM、PSG、RTH
[用途]
　指定した番号のPCMを鳴らす準備をします。番号は、\pcmコマンドでPCMファイル名と結び付けておきます。このコマンドを発行すると、PCMデータがFIFOバッファに送られはじめます。演奏を開始するには、*pstコマンドを発行してください。

●pst

[書式]
  *pst
[音源]
  FM、PSG、RTH
[用途]
　PCM音源の再生をはじめます。すでに、*pcmコマンドにて、データをFIFOバッファに送ってある必要があります。
　*pcmコマンドを発行してから、FIFOバッファに溜まるまでには、いくらか時間がかります。再生周波数の低いPCMデータならば、*pcm[番号]*pstと、つづけて書くことで再生ができますが、再生周波数の高いPCMデータですと、追い付かない場合があります。そのような場合には、*pcmコマンドと*pstコマンドの間隔をいくらか空けてください。

●ped

[書式]
  *ped
[音源]
  FM、PSG、RTH
[用途]
　演奏中のPCM音源を止めます。
