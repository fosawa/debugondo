各種ファイル構造

■OPNファイル

+----------+---------------+--------------------------------------------------+
|オフセット|内容           |説明                                              |
+----------+---------------+--------------------------------------------------+
|0〜2      |文字列"OPN"    |OPNファイル識別子                                 |
+----------+---------------+--------------------------------------------------+
|   3      |Ver 整数部     |MML2OPNのバージョンの整数部(現状では2)            |
+----------+---------------+--------------------------------------------------+
|   4      |Ver 小数部     |MML2OPNのバージョンの小数部(現状では0)            |
+----------+---------------+--------------------------------------------------+
|5〜6      |division       |データのdivision(WORD)                            |
+----------+---------------+--------------------------------------------------+
|7〜8      |チャネル1offset|FM音源チャネル1のデータオフセット(WORD)           |
|          |               |オフセットは、このアドレスからのオフセット(つまり |
|          |               |ファイル先頭からのオフセット-7)                   |
+----------+---------------+--------------------------------------------------+
|9〜36     |チャネル2〜    |チャネル2〜チャネル3:FM音源チャネル2〜3           |
|          |  チャネル15   |チャネル4〜チャネル6:PSG音源チャネル1〜3          |
|          |まで同上       |チャネル7〜チャネル9:FM音源チャネル4〜6           |
|          |               |チャネル10〜チャネル15:RTH音源チャネル1〜6        |
+----------+---------------+--------------------------------------------------+
|37〜      |曲データ       |曲データ。音色データ、曲データ、PCMデータの順に格 |
|          |               |納される。音色データと曲データ合わせて64Kバイトを |
|          |               |超えてはならない。PCMデータは64Kバイト以上でも構  |
|          |               |わない                                            |
+----------+---------------+--------------------------------------------------+

■SEファイル

+----------+---------------+--------------------------------------------------+
|オフセット|内容           |説明                                              |
+----------+---------------+--------------------------------------------------+
|0〜2      |文字列"SE "    |SEファイル識別子                                  |
+----------+---------------+--------------------------------------------------+
|   3      |Ver 整数部     |MML2OPNのバージョンの整数部(現状では2)            |
+----------+---------------+--------------------------------------------------+
|   4      |Ver 小数部     |MML2OPNのバージョンの小数部(現状では0)            |
+----------+---------------+--------------------------------------------------+
|   5      |SEの数         |ファイルに格納されているSE番号の数                |
+----------+---------------+--------------------------------------------------+
|6〜       |SE制御データ   |SE制御データ                                      |
| 6+SE数×5|               |SE1つにつき、5バイト(別記)                        |
|       -1 |               |                                                  |
+----------+---------------+--------------------------------------------------+
|6+SE数×5 |SEデータ       |SEデータ。音色データ、曲データ、PCMデータの順に格 |
|〜        |               |納される。音色データと曲データ合わせて64Kバイトを |
|          |               |超えてはならない。PCMデータは64Kバイト以上でも構  |
|          |               |わない                                            |
+----------+---------------+--------------------------------------------------+

●SE制御データ

+----------+---------------+--------------------------------------------------+
|オフセット|内容           |説明                                              |
+----------+---------------+--------------------------------------------------+
|0バイト   |使用チャネル   |bit7,bit6:使用チャネル                            |
|          |     /優先順位 |       00:未定義                                  |
|          |               |       01:PSG2チャネル使用                        |
|          |               |       10:PSG3チャネル使用                        |
|          |               |       11:PSG2チャネルとPSG3チャネル両方使用      |
|          |               |bit5〜bit0:優先順位(1〜63)                        |
+----------+---------------+--------------------------------------------------+
|1〜2バイト|PSG2CH offset  |PSG2チャネルのSEデータの入っているオフセット(WORD)|
|          |               |ファイル先頭からのオフセット。PSG2チャネルを使用  |
|          |               |ない場合には、0が入る。                           |
+----------+---------------+--------------------------------------------------+
|3〜4バイト|PSG3CH offset  |PSG3チャネルについて同上。                        |
+----------+---------------+--------------------------------------------------+


■PCMファイル

+----------+---------------+--------------------------------------------------+
|オフセット|内容           |説明                                              |
+----------+---------------+--------------------------------------------------+
|0〜2      |文字列"PCM"    |PCMファイル識別子                                 |
+----------+---------------+--------------------------------------------------+
|   3      |Ver 整数部     |WAV2PCMのバージョンの整数部(現状では2)            |
+----------+---------------+--------------------------------------------------+
|   4      |Ver 小数部     |WAV2PCMのバージョンの小数部(現状では0)            |
+----------+---------------+--------------------------------------------------+
|   5      |制御データ     |PCM量子化ビット数/再生周波数                      |
|          |               |bit7: 0固定                                       |
|          |               |bit6: 量子化ビット数(0=16bit,1=8bit)              |
|          |               |bit5: Lチャネル出力(0=OFF,1=ON)                   |
|          |               |bit4: Rチャネル出力(0=OFF,1=ON)                   |
|          |               |bit3: 0固定                                       |
|          |               |bit2〜bit0: 再生周波数                            |
|          |               |      000 = 44.10kHz, 001 = 33.08kHz              |
|          |               |      010 = 22.05kHz, 011 = 16.54kHz              |
|          |               |      100 = 11.03kHz, 101 = 8.27kHz               |
|          |               |      110 = 5.52kHz,  111 = 4.13kHz               |
+----------+---------------+--------------------------------------------------+
|6〜9      |PCMデータサイズ|PCMデータサイズ(dword)                            |
|          |               |以下に続くPCMデータの純粋なサイズであり、ファイル |
|          |               |全体のサイズではないことに注意。                  |
+----------+---------------+--------------------------------------------------+
|10〜      |PCMデータ      |PCMデータ。                                       |
|          |               |ステレオデータ(オフセット5の内容のbit5,bit4ともに1|
|          |               |の場合には、Lチャネル、Rチャネルの順に格納される。|
|          |               |16ビットの場合には、上位バイト、下位バイトの順に格|
|          |               |納される。                                        |
+----------+---------------+--------------------------------------------------+
※WAV2PCMによるコンバートでは、モノラルデータは作られない。モノラルデータは、LチャネルRチャネル共に同じデータを送信するステレオデータに変換される。
